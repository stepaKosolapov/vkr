Как видно на рис.~\ref{fig:mobility_scheme}, после запуска симуляции NS-2 имеются два артефакта --- трейс-файл движения пакетов и файл анимации.

Каждый из них можно проанализировать соответствующим способом. 

\subsection{Визуальный анализ}

Первый и самый очевидный способ анализа --- визуальный. Вместе с NS-2 в архиве \textquote{all-in-one} поставляется программа NetAnim~\cite{netanim}. Это програма для визуального отображения процесса симуляции.

В скрипте NS-2, как уже было рассмотрено ранее, присутствует специальная команда namtrace-all, которая записывает все события в файл анимации. 

После запуска симуляции, с помощью NetAnim можно просмотреть анимацию из полученного файла в формате .nam.

Интерфейс NetAnim изображён на рис.~\ref{fig:netanim_interface}.

\begin{figure}[!h]
  \centering
  \includegraphics[width=1\linewidth]{"NetAnim_interface.jpeg"}
  \caption{Интерфейс NetAnim}
  \label{fig:netanim_interface}
\end{figure}

При запуске анимации --- подвижные узлы сети начинают передвигаться и посылать пакеты. Узлы в интерфейсе изображены в виде круга, содержащего внутри себя номер узла, который был задан в скрипте NS-2. 

Так как используется беспроводной канал, широковещательные сообщения изображены расплывающимися окружностями от узла. 

Направленные пакеты к определённому узлу изображены отрезком, перемещающимся в пространстве от источника к приёмнику.

С помощью визуального наблюдения можно быстро определить те проблемы, которые труднее обнаружить с помощью анализа трейс-файла. 

Например, наблюдая за анимацией, можно обнаружить, что прямой связи между стационарными узлами не существует и пакеты начинают передаваться только когда между стационарными узлами появляется подвижный узел.

Пример кадра из анимации можно увидеть на рис.~\ref{fig:netanim_frame}.

\begin{figure}[!h]
  \centering
  \includegraphics[width=1\linewidth]{"NetAnim_frame.jpeg"}
  \caption{Кадр из анимации NetAnim}
  \label{fig:netanim_frame}
\end{figure}

\subsection{Структура трейс-файла}

Чтобы проводить не визуальный анализ сети, необходимо разобраться в том, как устроен второй полученный артефакт --- трейс-файл.

Для примера будет рассмотрена 16 строка из трейс-файла, часть содержимого которого можно видеть на рис.~\ref{fig:ns2_tracefile}.

Это позволит разобраться в том, как устроен трейс-файл и придумать принцип его анализа~\cite{salleh2006trace}.

\begin{figure}[!h]
  \centering
  \includegraphics[width=1\linewidth]{"ns2_tracefile.png"}
  \caption{Содержимое трейс-файла NS-2}
  \label{fig:ns2_tracefile}
\end{figure}

\begin{verbatim}
r 10.000948296 \_38\_ RTR  --- 0 AODV 48 [0 ffffffff 0 800] ------- 
[0:255 -1:255 30 0] [0x2 1 1 [1 0] [0 4]] (REQUEST)
\end{verbatim}
Эта строка из трейс-файла NS-2 содержит информацию об одном пакете, который был отправлен в сеть. 
Расшифровка элементов строки:

\begin{itemize}
  \item \verb|r| --- тип события, в данном случае это отправка пакета;
  \item \verb|10.000948296| --- время отправки пакета в секундах;
  \item \verb|\_38\_| --- идентификатор узла, который отправил пакет;
  \item \verb|RTR| --- тип узла, который отправил пакет (в данном случае это маршрутизатор);
  \item \verb|---| --- идентификатор узла, который должен получить пакет (в данном случае это широковещательный адрес);
  \item \verb|0| --- идентификатор канала, по которому был отправлен пакет;
  \item \verb|AODV| --- протокол маршрутизации, который использовался для отправки пакета;
  \item \verb|48| --- размер пакета в байтах;
  \item \verb|[0 ffffffff 0 800]| --- информация о маршруте, который будет использоваться для доставки пакета. В данном случае это начальный пакет, поэтому маршрут неизвестен и все значения установлены в ноль;
  \item \verb|-------| --- информация о том, какими типами нод был пройден пакет. В данном случае это еще неизвестно, поэтому все значения установлены в ноль;
  \item \verb|[0:255 -1:255 30 0]| --- информация о маршруте, который будет использоваться для доставки пакета. В данном случае это начальный пакет, поэтому маршрут не известен и все значения установлены в ноль;
  \item \verb|[0x2 1 1 [1 0] [0 4]]| --- информация о пакете. \verb|[0x2]| --- тип пакета, \verb|[1]| --- идентификатор пакета, \verb|[1]| --- количество попыток отправки, \verb|[1 0]| --- номер сегмента, который был отправлен, \verb|[0 4]| --- номер сегмента, который будет отправлен;
  \item \verb|(REQUEST)| --- тип пакета, в данном случае это запрос.
\end{itemize}

Из трейс-файла можно понять состояние каждого пакета в любой момент времени симуляции: размер пакета, пункт назначения, маршрут и т.п.

Это знание позволяет провести анализ производительности сети, обработав и достав нужную информацию о пакетах из трейс-файла.

\subsection{Подсчёт параметров сети}

Чтобы посчитать параметры сети зачастую используются скрипты в формате awk. 

Принцип написания этих файлов прост, каждая строка трейс-файла разделяется на части. Как было указано выше, данные в строке трейс-файла разделены пробелами, поэтому после разделения строки пробелами получается массив данных. Каждый элемент в зависимости от типа сообщения содержит разные данные. 

Предлагается рассчитать несколько интересных для исследования параметров сети~\cite{taneja2011evaluation}:

\begin{itemize}
  \item PDR (Packet Delivery Ratio) --- процент доставки пакетов;
  \item Delay --- время, требующеся для доставки пакета внутри сети;
  \item Throughput --- пропускная способность сети;
  \item NRL (Normalized Routing Load) --- метрика, показывающая сколько пакетов из всех отправленных служит целям роутинга, а не передаче данных;
  \item Packets sent --- количество отправленных пакетов внутри сети.
\end{itemize}

\subsection{Коэффициент успешной доставки пакетов}

Коэффициент успешной доставки пакетов (PDR) определяется как отношение числа пакетов, которые были успешно доставлены к месту назначения, к числу пакетов данных, отправленных из источника. Этот показатель вычисляется путем деления количества пакетов, полученных пунктом назначения, на количество пакетов, исходящих от источника. Высокий коэффициент PDR свидетельствует о лучшей производительности протокола.

\begin{equation}
  \label{eq:pdr_calculation}
  \text{PDR} = \frac{P_r}{P_s} \cdot 100\%,
\end{equation}
где $P_r$ --- суммарное количество отправленных пакетов, а $P_s$ --- суммарное количество принятых пакетов.

\subsection{Задержка}

Среднее время задержки определяется как общее временя от отправления пакета источником до его прибытия к пункту назначения.

\begin{equation}
  \label{eq:delay_calculation}
  \text{EED} = \frac{1}{n} \sum_{i=1}^{n}(T_{r_i} - T_{s_i}) \cdot 1000,
\end{equation}
где $i$ --- идентификатор пакета, $n$ --- число успешно доставленных пакетов, $T_{r_i}$ --- время приёма пакета, а $T_{s_i}$ --- время отправки пакета. 

\subsection{Пропускная способность}

Пропускная способность определяется как число пакетов с данными, которые были успешно доставлены в сети за единицу времени. Высокая пропускная способность свидетельствует о лучшей производительности протокола.

\begin{equation}
  \label{eq:throughput_calculation}
  \text{TH} = \frac{B_r \cdot 8}{T_{\text{stop}} - T_{\text{start}} \cdot 1000},
\end{equation}
где $B_r$ --- количество полученных битов, $T_{\text{start}}$ --- время старта отправки, $T_{\text{stop}}$ --- время конца отправки.

\subsection{Метрика NRL} 

Основная цель NRL --- измерить количество управляющих данных, необходимых для доставки пакетов данных от источника к получателю, нормализуя это значение на количество успешно доставленных пакетов данных. Это позволяет провести сравнение эффективности маршрутизации между различными протоколами или конфигурациями сети относительно использования сетевых ресурсов.

\begin{equation}
  \label{eq:nrl_calculation}
  \text{NRL} = \frac{P_{s_{\text{routing}}}}{P_{r_{\text{data}}}},
\end{equation}
где $P_{s_{\text{routing}}}$ --- количество отправленных управляющих пакетов (необходимых для обеспечения маршрутизации), а $P_{r_{\text{data}}}$ --- количество успешно принятых пакетов с данными.

\subsection{Количество отправленных пакетов}

Эта метрика отвечает за количество отправленных пакетов в сети и никакой особой формулы для вычисления не имеет, достаточно подсчитывать все отправленные пакеты.

